{
  "game": "werewolf_standard",
  "schema_version": 1,
  "start_node": "ww_setup_players",
  "nodes": {
    "ww_setup_players": {
      "stage": "准备",
      "title": "选择人数与板子",
      "body": "我们先用一个“标准9人示例板”来体验：\n\n- 3 狼人\n- 预言家\n- 女巫\n- 猎人\n- 3 平民\n\n如果你们人数不同，也可以先按这个流程体验产品是否好用（后续再做可配置）。",
      "ui": {
        "fields": [
          {
            "key": "player_count",
            "label": "玩家人数",
            "type": "select",
            "required": true,
            "options": [
              {"label": "9", "value": 9}
            ],
            "help": "示例板固定 9 人。"
          },
          {
            "key": "role_preset",
            "label": "板子选择",
            "type": "select",
            "required": true,
            "options": [
              {"label": "标准9人示例板（3狼 预女猎 3民）", "value": "std9"}
            ]
          }
        ]
      },
      "actions": [{"id": "next", "label": "下一步"}],
      "on": {
        "next": {"to": "ww_setup_roles"}
      }
    },

    "ww_setup_roles": {
      "stage": "准备",
      "title": "发身份与坐席编号",
      "body": "1) 洗混身份牌并发放，每人只看自己的身份。\n2) 给每个玩家一个坐席号（1~9），方便发言与投票。\n3) 确认主持人口径：夜晚阶段按顺序叫醒角色。\n\n常见误区：发言阶段暴露自己的夜晚信息来源。",
      "ui": {
        "fields": [
          {"key": "identities_dealt", "label": "已发身份并确认所有人看过", "type": "checkbox", "required": true}
        ]
      },
      "actions": [{"id": "next", "label": "进入夜晚"}],
      "on": {
        "next": {
          "branches": [
            {"if": [{"key": "identities_dealt", "op": "eq", "value": true}], "then": "ww_night_intro"},
            {"then": "ww_setup_roles"}
          ]
        }
      }
    },

    "ww_night_intro": {
      "stage": "夜晚",
      "title": "夜晚流程总览",
      "body": "夜晚是“信息与技能”阶段。示例板建议顺序：\n\n1) 狼人行动（击杀目标）\n2) 预言家验人（得知阵营）\n3) 女巫（是否救人/是否毒人）\n\n现在我们进入第1夜。",
      "actions": [{"id": "start_night", "label": "开始第1夜"}],
      "on": {
        "start_night": {"set": {"day": 0, "alive": 9, "wolves_alive": 3, "good_alive": 6}, "to": "ww_night_wolves"}
      }
    },

    "ww_night_wolves": {
      "stage": "夜晚",
      "title": "狼人行动：选择击杀目标",
      "body": "主持人叫醒狼人：狼人统一手势指向一个目标（坐席号）。\n\n提示：这里先把“狼人击杀目标”记录下来，后续由女巫决定是否救。",
      "ui": {
        "fields": [
          {"key": "night_kill_target", "label": "狼人击杀目标（坐席号 1~9）", "type": "number", "required": true, "min": 1, "max": 9}
        ]
      },
      "actions": [{"id": "next", "label": "叫醒预言家"}],
      "on": {
        "next": {"to": "ww_night_seer"}
      }
    },

    "ww_night_seer": {
      "stage": "夜晚",
      "title": "预言家：验人",
      "body": "主持人叫醒预言家：预言家指向一名玩家，主持人示意其阵营（好/坏）。\n\n产品提示：你可以先只记录“验了谁”，不用记录结果（结果只在预言家本人心里）。",
      "ui": {
        "fields": [
          {"key": "seer_check_target", "label": "预言家验的人（坐席号 1~9）", "type": "number", "required": true, "min": 1, "max": 9}
        ]
      },
      "actions": [{"id": "next", "label": "叫醒女巫"}],
      "on": {
        "next": {"to": "ww_night_witch"}
      }
    },

    "ww_night_witch": {
      "stage": "夜晚",
      "title": "女巫：救与毒",
      "body": "主持人叫醒女巫：告知今晚被刀的人（night_kill_target）。\n\n女巫可选择：\n- 用解药救人（通常整局 1 次）\n- 用毒药毒人（通常整局 1 次）\n- 或都不用\n\n现在我们用最小记录：你只需填“是否救、是否毒、毒谁”。",
      "ui": {
        "fields": [
          {"key": "witch_save", "label": "女巫是否使用解药救人", "type": "checkbox", "required": true},
          {"key": "witch_poison", "label": "女巫是否使用毒药", "type": "checkbox", "required": true},
          {"key": "witch_poison_target", "label": "若使用毒药：毒的目标（坐席号）", "type": "number", "required": false, "min": 1, "max": 9}
        ]
      },
      "actions": [{"id": "resolve_night", "label": "结算夜晚"}],
      "on": {
        "resolve_night": {"to": "ww_day_reveal"}
      }
    },

    "ww_day_reveal": {
      "stage": "白天",
      "title": "天亮：公布昨夜结果",
      "body": "主持人宣布昨夜情况：\n- 若女巫救人：可能“平安夜”。\n- 若女巫毒人：可能额外有人倒牌。\n\n接下来进入发言与投票阶段。",
      "actions": [{"id": "next", "label": "进入发言"}],
      "on": {
        "next": {"inc": {"day": 1}, "to": "ww_day_speech"}
      }
    },

    "ww_day_speech": {
      "stage": "白天",
      "title": "发言阶段：一人一轮",
      "body": "建议流程：\n1) 从某个起始位开始顺序发言（或从死者左手开始）。\n2) 每人用 20~40 秒说清楚：自己身份倾向、怀疑点、投票意向。\n\n产品提示：你可以问我“我该怎么组织发言顺序/控时/避免跑题”。",
      "actions": [{"id": "next", "label": "进入投票"}],
      "on": {
        "next": {"to": "ww_day_vote"}
      }
    },

    "ww_day_vote": {
      "stage": "白天",
      "title": "投票处决",
      "body": "所有存活玩家投票处决 1 人。\n\n这里我们先只记录：被处决的是谁（坐席号）。若被处决的是猎人，可能触发带走。",
      "ui": {
        "fields": [
          {"key": "executed_seat", "label": "被处决玩家（坐席号 1~9）", "type": "number", "required": true, "min": 1, "max": 9},
          {"key": "executed_is_hunter", "label": "被处决者是否是猎人", "type": "checkbox", "required": true},
          {"key": "hunter_shot_target", "label": "若猎人带走：带走谁（坐席号）", "type": "number", "required": false, "min": 1, "max": 9}
        ]
      },
      "actions": [{"id": "resolve_day", "label": "结算白天"}],
      "on": {
        "resolve_day": {"to": "ww_check_win"}
      }
    },

    "ww_check_win": {
      "stage": "结算",
      "title": "检查胜负",
      "body": "常见胜负：\n- 若狼人全部出局：好人获胜\n- 若狼人数量 ≥ 好人数量：狼人获胜\n- 否则进入下一夜\n\n现在你可以告诉我：当前狼人/好人各剩多少（或只告诉我死亡名单）。",
      "ui": {
        "fields": [
          {"key": "wolves_alive", "label": "当前狼人存活数", "type": "number", "required": true, "min": 0, "max": 9},
          {"key": "good_alive", "label": "当前好人存活数", "type": "number", "required": true, "min": 0, "max": 9}
        ]
      },
      "actions": [
        {"id": "wolves_win", "label": "狼人获胜"},
        {"id": "good_win", "label": "好人获胜"},
        {"id": "next_night", "label": "继续下一夜"}
      ],
      "on": {
        "wolves_win": {"to": "ww_end_wolves"},
        "good_win": {"to": "ww_end_good"},
        "next_night": {"to": "ww_night_wolves"}
      }
    },

    "ww_end_good": {
      "stage": "结束",
      "title": "好人获胜",
      "body": "恭喜好人阵营获胜！\n\n复盘建议：\n- 预言家何时跳身份最合适？\n- 女巫的救/毒是否改变了关键轮次？",
      "actions": [{"id": "restart", "label": "重新开始"}],
      "on": {"restart": {"to": "ww_setup_players"}}
    },

    "ww_end_wolves": {
      "stage": "结束",
      "title": "狼人获胜",
      "body": "狼人阵营获胜。\n\n复盘建议：\n- 哪一轮发言把节奏带偏了？\n- 投票时哪些站边最关键？",
      "actions": [{"id": "restart", "label": "重新开始"}],
      "on": {"restart": {"to": "ww_setup_players"}}
    }
  }
}
